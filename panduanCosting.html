<!DOCTYPE html>
<html lang="en">
<head>
    

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulir Perhitungan Produk</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/docxtemplater/3.23.0/docxtemplater.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f9;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 0 auto;
            background-color: #fff;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        table, th, td {
            border: 1px solid #ddd;
            padding: 2px;
            text-align: center;
        }

        th, td {
            background-color: #f4f4f4;
        }

        th {
            background-color: #007bff;
            color: white;
        }

        td input {
            width: 100%;
            padding: 2px;
            border: 1px solid #ccc;
            border-radius: 2px;
            text-align: center;
            font-size: 12px;
            margin: 2px 0;
            background-color: #f9f9f9;
        }

        td input[type="text"] , input[type="number"]{
            width: 80%;
        }
        td input:focus {
            border-color: #007bff;
            background-color: #f0f8ff;
            outline: none;
        }

        button {
            background-color: #28a745;
            color: white;
            border: none;
            padding: 8px 15px;
            font-size: 14px;
            cursor: pointer;
            border-radius: 2px;
            width: 100%;
            margin-top: 15px;
        }

        button:hover {
            background-color: #218838;
        }
    
    </style>
</head>
<body>
    
<form>
    <table id="my-table">
        <thead>
            <tr>
                <th colspan="10">PRODUCT CALCULATION TABLE</th>
            </tr>
            <tr>
                <th style="width:10%; font-size: 12px;">PRODUCT NAME</th> <!-- Kolom Judul di atas ITEM NAME -->
                <th style="width:4%; font-size: 12px;">NO</th>
                <th style="width:15%; font-size: 12px;">ITEM NAME</th>
                <th style="width:8%; font-size: 12px;">QTY</th>
                <th style="width:8%; font-size: 12px;">UT</th>
                <th style="width:8%; font-size: 12px;">LOSS (%)</th>
                <th style="width:10%; font-size: 12px;">PRICE</th>
                <th style="width:15%; font-size: 12px;">NETT PRICE</th>
                <th style="width:10%; font-size: 12px;">UNIT</th>
                <th style="width:15%; font-size: 12px;">TOTAL PRICE</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><input type="text" name="judul" placeholder="" /></td> <!-- Kolom input untuk judul -->
                <td style="text-align: center; font-weight: bold; font-size: 12px;">1</td>
                <td><input type="text" name="item_name1" placeholder="" /></td>
                <td><input type="number" name="qty1" placeholder="" oninput="calculateTotalPrice(1)" /></td>
                <td><input type="text" name="ut1" placeholder="" /></td>
                <td><input type="number" name="loss1" placeholder="" oninput="calculateNettPrice(1); calculateTotalPrice(1)" /></td>
                <td><input type="number" name="price1" placeholder="" oninput="calculateNettPrice(1); calculateTotalPrice(1)" /></td>
                <td><input type="text" name="nett_price1" placeholder="" readonly /></td>
                <td><input type="number" name="unit1" placeholder="" oninput="calculateTotalPrice(1)" /></td>
                <td><input type="text" name="total_price1" placeholder="" readonly /></td>
            </tr>
            <tr>
                <td></td>
                <td style="text-align: center; font-weight: bold; font-size: 12px;">2</td>
                <td><input type="text" name="item_name2" placeholder="" /></td>
                <td><input type="number" name="qty2" placeholder="" oninput="calculateTotalPrice(2)" /></td>
                <td><input type="text" name="ut2" placeholder="" /></td>
                <td><input type="number" name="loss2" placeholder="" oninput="calculateNettPrice(2); calculateTotalPrice(2)" /></td>
                <td><input type="number" name="price2" placeholder="" oninput="calculateNettPrice(2); calculateTotalPrice(2)" /></td>
                <td><input type="text" name="nett_price2" placeholder="" readonly /></td>
                <td><input type="number" name="unit2" placeholder="" oninput="calculateTotalPrice(2)" /></td>
                <td><input type="text" name="total_price2" placeholder="" readonly /></td>
            </tr>
            <tr>
                <td></td>
                <td style="text-align: center; font-weight: bold; font-size: 12px;">3</td>
                <td><input type="text" name="item_name3" placeholder="" /></td>
                <td><input type="number" name="qty3" placeholder="" oninput="calculateTotalPrice(3)" /></td>
                <td><input type="text" name="ut3" placeholder="" /></td>
                <td><input type="number" name="loss3" placeholder="" oninput="calculateNettPrice(3); calculateTotalPrice(3)" /></td>
                <td><input type="number" name="price3" placeholder="" oninput="calculateNettPrice(3); calculateTotalPrice(3)" /></td>
                <td><input type="text" name="nett_price3" placeholder="" readonly /></td>
                <td><input type="number" name="unit3" placeholder="" oninput="calculateTotalPrice(3)" /></td>
                <td><input type="text" name="total_price3" placeholder="" readonly /></td>
            </tr>
            <tr>
                <td></td>
                <td style="text-align: center; font-weight: bold; font-size: 12px;">4</td>
                <td><input type="text" name="item_name4" placeholder="" /></td>
                <td><input type="number" name="qty4" placeholder="" oninput="calculateTotalPrice(4)" /></td>
                <td><input type="text" name="ut3" placeholder="" /></td>
                <td><input type="number" name="loss4" placeholder="" oninput="calculateNettPrice(4); calculateTotalPrice(4)" /></td>
                <td><input type="number" name="price4" placeholder="" oninput="calculateNettPrice(4); calculateTotalPrice(4)" /></td>
                <td><input type="text" name="nett_price4" placeholder="" readonly /></td>
                <td><input type="number" name="unit4" placeholder="" oninput="calculateTotalPrice(4)" /></td>
                <td><input type="text" name="total_price4" placeholder="" readonly /></td>
            </tr>
            <tr>
                <td></td>
                <td style="text-align: center; font-weight: bold; font-size: 12px;">5</td>
                <td><input type="text" name="item_name5" placeholder="" /></td>
                <td><input type="number" name="qty5" placeholder="" oninput="calculateTotalPrice(5)" /></td>
                <td><input type="text" name="ut5" placeholder="" /></td>
                <td><input type="number" name="loss5" placeholder="" oninput="calculateNettPrice(5); calculateTotalPrice(5)" /></td>
                <td><input type="number" name="price5" placeholder="" oninput="calculateNettPrice(5); calculateTotalPrice(5)" /></td>
                <td><input type="text" name="nett_price5" placeholder="" readonly /></td>
                <td><input type="number" name="unit5" placeholder="" oninput="calculateTotalPrice(5)" /></td>
                <td><input type="text" name="total_price5" placeholder="" readonly /></td>
            </tr>
            <tr>
                <td></td>
                <td style="text-align: center; font-weight: bold; font-size: 12px;">6</td>
                <td><input type="text" name="item_name6" placeholder="" /></td>
                <td><input type="number" name="qty6" placeholder="" oninput="calculateTotalPrice(6)" /></td>
                <td><input type="text" name="ut6" placeholder="" /></td>
                <td><input type="number" name="loss6" placeholder="" oninput="calculateNettPrice(6); calculateTotalPrice(6)" /></td>
                <td><input type="number" name="price6" placeholder="" oninput="calculateNettPrice(6); calculateTotalPrice(6)" /></td>
                <td><input type="text" name="nett_price6" placeholder="" readonly /></td>
                <td><input type="number" name="unit6" placeholder="" oninput="calculateTotalPrice(6)" /></td>
                <td><input type="text" name="total_price6" placeholder="" readonly /></td>
            </tr>
            <tr>
                <td></td>
                <td style="text-align: center; font-weight: bold; font-size: 12px;">7</td>
                <td><input type="text" name="item_name7" placeholder="" /></td>
                <td><input type="number" name="qty7" placeholder="" oninput="calculateTotalPrice(7)" /></td>
                <td><input type="text" name="ut7" placeholder="" /></td>
                <td><input type="number" name="loss7" placeholder="" oninput="calculateNettPrice(7); calculateTotalPrice(7)" /></td>
                <td><input type="number" name="price7" placeholder="" oninput="calculateNettPrice(7); calculateTotalPrice(7)" /></td>
                <td><input type="text" name="nett_price7" placeholder="" readonly /></td>
                <td><input type="number" name="unit7" placeholder="" oninput="calculateTotalPrice(7)" /></td>
                <td><input type="text" name="total_price7" placeholder="" readonly /></td>
            </tr>
            <tr>
                <td></td>
                <td style="text-align: center; font-weight: bold; font-size: 12px;">8</td>
                <td><input type="text" name="item_name8" placeholder="" /></td>
                <td><input type="number" name="qty8" placeholder="" oninput="calculateTotalPrice(8)" /></td>
                <td><input type="text" name="ut8" placeholder="" /></td>
                <td><input type="number" name="loss8" placeholder="" oninput="calculateNettPrice(8); calculateTotalPrice(8)" /></td>
                <td><input type="number" name="price8" placeholder="" oninput="calculateNettPrice(8); calculateTotalPrice(8)" /></td>
                <td><input type="text" name="nett_price8" placeholder="" readonly /></td>
                <td><input type="number" name="unit8" placeholder="" oninput="calculateTotalPrice(8)" /></td>
                <td><input type="text" name="total_price8" placeholder="" readonly /></td>
            </tr> <tr>
                <td></td>
                <td style="text-align: center; font-weight: bold; font-size: 12px;">9</td>
                <td><input type="text" name="item_name9" placeholder="" /></td>
                <td><input type="number" name="qty9" placeholder="" oninput="calculateTotalPrice(9)" /></td>
                <td><input type="text" name="ut9" placeholder="" /></td>
                <td><input type="number" name="loss9" placeholder="" oninput="calculateNettPrice(9); calculateTotalPrice(9)" /></td>
                <td><input type="number" name="price9" placeholder="" oninput="calculateNettPrice(9); calculateTotalPrice(9)" /></td>
                <td><input type="text" name="nett_price9" placeholder="" readonly /></td>
                <td><input type="number" name="unit9" placeholder="" oninput="calculateTotalPrice(9)" /></td>
                <td><input type="text" name="total_price9" placeholder="" readonly /></td>
            </tr>
            <tr>
                <td></td>
                <td style="text-align: center; font-weight: bold; font-size: 12px;">10</td>
                <td><input type="text" name="item_name10" placeholder="" /></td>
                <td><input type="number" name="qty10" placeholder="" oninput="calculateTotalPrice(10)" /></td>
                <td><input type="text" name="ut10" placeholder="" /></td>
                <td><input type="number" name="loss10" placeholder="" oninput="calculateNettPrice(10); calculateTotalPrice(10)" /></td>
                <td><input type="number" name="price10" placeholder="" oninput="calculateNettPrice(10); calculateTotalPrice(10)" /></td>
                <td><input type="text" name="nett_price10" placeholder="" readonly /></td>
                <td><input type="number" name="unit10" placeholder="" oninput="calculateTotalPrice(10)" /></td>
                <td><input type="text" name="total_price10" placeholder="" readonly /></td>
            </tr>
            <tr>
                <td></td>
                <td style="text-align: center; font-weight: bold; font-size: 12px;">11</td>
                <td><input type="text" name="item_name11" placeholder="" /></td>
                <td><input type="number" name="qty11" placeholder="" oninput="calculateTotalPrice(11)" /></td>
                <td><input type="text" name="ut11" placeholder="" /></td>
                <td><input type="number" name="loss11" placeholder="" oninput="calculateNettPrice(11); calculateTotalPrice(11)" /></td>
                <td><input type="number" name="price11" placeholder="" oninput="calculateNettPrice(11); calculateTotalPrice(11)" /></td>
                <td><input type="text" name="nett_price11" placeholder="" readonly /></td>
                <td><input type="number" name="unit11" placeholder="" oninput="calculateTotalPrice(11)" /></td>
                <td><input type="text" name="total_price11" placeholder="" readonly /></td>
            </tr>
            <tr>
                <td></td>
                <td style="text-align: center; font-weight: bold; font-size: 12px;">12</td>
                <td><input type="text" name="item_name12" placeholder="" /></td>
                <td><input type="number" name="qty12" placeholder="" oninput="calculateTotalPrice(12)" /></td>
                <td><input type="text" name="ut12" placeholder="" /></td>
                <td><input type="number" name="loss12" placeholder="" oninput="calculateNettPrice(12); calculateTotalPrice(12)" /></td>
                <td><input type="number" name="price12" placeholder="" oninput="calculateNettPrice(12); calculateTotalPrice(12)" /></td>
                <td><input type="text" name="nett_price12" placeholder="" readonly /></td>
                <td><input type="number" name="unit12" placeholder="" oninput="calculateTotalPrice(12)" /></td>
                <td><input type="text" name="total_price12" placeholder="" readonly /></td>
            </tr>
            <!-- Baris untuk Basic Cost -->
            <tr>
                <td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
                <td style="text-align: left; font-weight: bold; font-size: 12px;">BASIC COST</td>
                <td><input type="text" name="basic_cost" id="basic_cost" placeholder="" readonly /></td>
            </tr>
            <!-- Baris untuk Add Cost -->
            <tr>
                <td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
                <td style="text-align: left; font-weight: bold; font-size: 12px;">ADD COST (%)</td>
                <td><input type="number" name="add_cost" id="add_cost" placeholder="" oninput="calculateAddCost()" /></td>
            </tr>
            <!-- Baris untuk Total Cost setelah Add Cost -->
            <tr>
                <td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
                <td style="text-align: left; font-weight: bold; font-size: 12px;">TOTAL COST</td>
                <td><input type="text" name="total_cost" id="total_cost" placeholder="" readonly /></td>
            </tr>
            <!-- Baris untuk % Cost -->
            <tr>
                <td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
                <td style="text-align: left; font-weight: bold; font-size: 12px;">% COST</td>
                <td><input type="number" name="cost_percent" id="cost_percent" placeholder="" oninput="calculateFinalCost()" /></td>
            </tr>
            <!-- Baris untuk Final Total Cost -->
            <tr>
                <td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
                <td style="text-align: left; font-weight: bold; font-size: 12px;">SELLING PRICE</td>
                <td><input type="text" name="final_total_cost" id="final_total_cost" placeholder="" readonly /></td>
            </tr>
        </tbody>
    </table>
    <button type="button" onclick="downloadTableAsPDF()">Download PDF</button>
</form>

<script>
    // Fungsi untuk menghitung Nett Price
    function calculateNettPrice(row) {
        var price = parseFloat(document.querySelector(`input[name="price${row}"]`).value);
        var loss = parseFloat(document.querySelector(`input[name="loss${row}"]`).value);

        if (!isNaN(price) && !isNaN(loss)) {
            var nettPrice = price + (price * loss / 100);
            var formattedNettPrice = formatRupiah(nettPrice);
            document.querySelector(`input[name="nett_price${row}"]`).value = formattedNettPrice;
        }
    }

    // Fungsi untuk memformat angka menjadi format Rupiah
    function formatRupiah(angka) {
        var rupiah = new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR' }).format(angka);
        return rupiah.replace('Rp', 'Rp '); // Menambahkan spasi setelah 'Rp'
    }

    // Fungsi untuk menghitung Total Price
    function calculateTotalPrice(row) {
        var nettPrice = parseFloat(document.querySelector(`input[name="nett_price${row}"]`).value.replace('Rp ', '').replace('.', '').replace(',', '.'));
        var qty = parseFloat(document.querySelector(`input[name="qty${row}"]`).value);
        var unit = parseFloat(document.querySelector(`input[name="unit${row}"]`).value);

        if (!isNaN(nettPrice) && !isNaN(qty) && !isNaN(unit)) {
            var totalPrice = (nettPrice / unit) * qty;
            var formattedTotalPrice = formatRupiah(totalPrice);
            document.querySelector(`input[name="total_price${row}"]`).value = formattedTotalPrice;
        }
        calculateBasicCost();
    }

    // Fungsi untuk menghitung Basic Cost
    function calculateBasicCost() {
        var totalCost = 0;

        for (var i = 1; i <= 12; i++) {
            var totalPrice = document.querySelector(`input[name="total_price${i}"]`).value;
            if (totalPrice) {
                var priceValue = parseFloat(totalPrice.replace('Rp ', '').replace('.', '').replace(',', '.'));
                if (!isNaN(priceValue)) {
                    totalCost += priceValue;
                }
            }
        }
        document.getElementById("basic_cost").value = formatRupiah(totalCost);
        calculateTotalCostAfterAddCost(totalCost);
    }

    // Fungsi untuk menghitung Add Cost
    function calculateAddCost() {
        var addCostPercent = parseFloat(document.getElementById("add_cost").value);
        var basicCost = parseFloat(document.getElementById("basic_cost").value.replace('Rp ', '').replace('.', '').replace(',', '.'));

        if (!isNaN(addCostPercent) && !isNaN(basicCost)) {
            var addCostValue = (addCostPercent / 100) * basicCost;
            var totalCostAfterAddCost = basicCost + addCostValue;
            document.getElementById("total_cost").value = formatRupiah(totalCostAfterAddCost);
        }
    }

    // Fungsi untuk menghitung Total Cost setelah Add Cost
    function calculateTotalCostAfterAddCost(basicCost) {
        var addCostPercent = parseFloat(document.getElementById("add_cost").value);
        if (!isNaN(addCostPercent)) {
            var addCostValue = (addCostPercent / 100) * basicCost;
            var totalCostAfterAddCost = basicCost + addCostValue;
            document.getElementById("total_cost").value = formatRupiah(totalCostAfterAddCost);
        }
    }

    // Fungsi untuk menghitung Final Total Cost
    function calculateFinalCost() {
        var totalCostAfterAddCost = parseFloat(document.getElementById("total_cost").value.replace('Rp ', '').replace('.', '').replace(',', '.'));
        var costPercent = parseFloat(document.getElementById("cost_percent").value);

        if (!isNaN(totalCostAfterAddCost) && !isNaN(costPercent)) {
            var finalTotalCost = totalCostAfterAddCost / (costPercent / 100);
            document.getElementById("final_total_cost").value = formatRupiah(finalTotalCost);
        }
    }

    function downloadWord() {
    // Mengambil elemen tabel berdasarkan ID
    const table = document.getElementById("my-table");

    // Membuat salinan tabel untuk diolah tanpa memengaruhi tabel asli
    const clonedTable = table.cloneNode(true);
    const inputs = clonedTable.querySelectorAll("input, textarea");

    // Mengubah input/textarea menjadi teks nilai
    inputs.forEach(input => {
        const td = input.parentElement;
        td.textContent = input.value;
    });

    // HTML untuk dokumen Word dengan pengaturan tengah halaman
    const htmlContent = `
        <html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word' xmlns='http://www.w3.org/TR/REC-html40'>
            <head>
                <meta charset='utf-8'>
                <title>Export Table to Word</title>
                <style>
                    body {
                        margin: 0; /* Hapus margin default */
                        display: flex;
                        justify-content: center; /* Menempatkan tabel di tengah horizontal */
                        align-items: center; /* Menempatkan tabel di tengah vertikal */
                        height: 100vh; /* Pastikan tinggi badan sesuai halaman */
                        font-family: Arial, sans-serif;
                        font-size: 12px;
                        text-align: center; /* Teks rata tengah */
                    }
                    table {
                        border-collapse: collapse;
                        width: 80%; /* Lebar tabel 80% dari halaman */
                        table-layout: fixed; /* Kolom dengan lebar tetap */
                    }
                    th, td {
                        border: 1px solid black;
                        padding: 8px;
                        text-align: center; /* Isi tabel rata tengah */
                        word-wrap: break-word; /* Bungkus teks panjang */
                    }
                    td:last-child {
                        padding-right: 10px; /* Jarak kolom terakhir */
                    }
                </style>
            </head>
            <body>
                ${clonedTable.outerHTML}
            </body>
        </html>
    `;

    // Membuat Blob dari HTML
    const blob = new Blob(['\ufeff', htmlContent], { type: 'application/msword' });

    // Mendownload file dengan nama 'tabel.doc'
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = 'tabel.doc';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}

function downloadTableAsPDF() {
  const table = document.getElementById('my-table');

  const options = {
    margin: 1, // Margin wajar untuk dokumen formal
    filename: 'tabel-download.pdf',
    html2canvas: { scale: 2, useCORS: true }, // Render lebih tajam
    jsPDF: { unit: 'mm', format: 'a4', orientation: 'landscape' } // Format A4, orientasi portrait
  };

  html2pdf().set(options).from(table).save();
}
</script>
</body>
</html>
